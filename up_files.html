<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SAD — Adicionar Documento do Concurso</title>
    <link
      rel="icon"
      href="https://statics.recife.pe.gov.br/images/dynamics/conecta/icons/favicon.png?w=32&h=32&fit=fill&border=2,transparent,shrink"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <style>
      :root {
        --brand-primary: #0053a4;
        --brand-secondary: #003a73;
        --brand-highlight: #00a3ff;
        --surface: #f4f7fb;
        --surface-strong: #ffffff;
        --border-color: #d0d7e2;
        --text-strong: #1b263b;
        --text-muted: #5b6c8c;
        --bs-primary: var(--brand-primary);
        --bs-primary-rgb: 0, 83, 164;
        --bs-body-font-family: "Public Sans", system-ui, -apple-system,
          BlinkMacSystemFont, "Segoe UI", sans-serif;
        --bs-body-color: var(--text-strong);
        --bs-body-bg: var(--surface);
      }
      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }
      body {
        font-family: var(--bs-body-font-family);
        background: var(--surface);
        color: var(--text-strong);
        min-height: 100vh;
      }
      .section-title {
        display: flex;
        align-items: center;
        gap: 0.65rem;
        font-weight: 700;
        font-size: 1.2rem;
        letter-spacing: 0.02em;
        color: var(--text-strong);
      }
      .section-title::before {
        content: "";
        display: inline-block;
        width: 32px;
        height: 3px;
        border-radius: 999px;
        background: var(--brand-highlight);
      }
      .form-documento-concurso .form-label {
        font-weight: 600;
        color: var(--text-strong);
      }
      .form-documento-concurso .form-text {
        color: var(--text-muted);
        font-size: 0.9rem;
      }
      .form-documento-concurso .btn-primary {
        border-radius: 999px;
        padding-inline: 1.6rem;
        font-weight: 600;
        letter-spacing: 0.01em;
      }
      .card {
        border: 1px solid rgba(0, 83, 164, 0.08);
        border-radius: 4px;
        background: var(--surface-strong);
        box-shadow: 0 16px 34px rgba(0, 45, 98, 0.08);
      }
      .rounded-4 {
        border-radius: 4px !important;
      }
      header.site-header {
        background: url("https://statics.recife.pe.gov.br/images/dynamics/automacao/header.png?w=3000")
          center/cover no-repeat;
        color: #ffffff;
        padding: 3.5rem 0 2.75rem;
      }
      footer {
        color: var(--text-muted);
        padding: 2.5rem 0 2rem;
        font-size: 0.9rem;
        background: var(--surface-strong);
        border-top: 1px solid var(--border-color);
        margin-top: 5rem;
      }
    </style>
    </head>
  <body>
    <header class="site-header">
      <div class="container">
        <h1 class="display-6 fw-semibold mt-3">Portal da Banca Organizadora</h1>
        <p class="lead mt-2" style="max-width: 100%">
          Área restrita para gerenciamento de publicações do concurso.
        </p>
      </div>
    </header>

    <main class="container my-5">
      <div class="row">
        <div class="col-lg-8 mx-auto">
          <h2 class="section-title mb-4">Adicionar Novo Documento</h2>

          <div class="card bg-white rounded-4 border shadow-sm">
            <div class="card-body p-4 p-md-5">
              <form
                class="form-documento-concurso"
                id="form-documento"
                action="https://webhook-n8n-dev-conectarecife.recife.pe.gov.br/webhook/publicacaodocumentoshv"
                method="POST"
              >
                <div class="mb-3">
                  <label for="doc-descricao" class="form-label"
                    >Descrição</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="doc-descricao"
                    name="doc-descricao"
                    placeholder="Ex: Resultado Preliminar da Análise Curricular"
                    required
                  />
                  <div class="form-text">
                    Informe o título público do documento (ex: Edital,
                    Convocação, Resultado Final).
                  </div>
                </div>

                <div class="mb-4">
                  <label for="arquivo" class="form-label">Arquivo</label>
                  <input
                    class="form-control"
                    type="file"
                    id="arquivo"
                    name="arquivo"
                    required
                  />
                  <div class="form-text">
                    Anexe o documento oficial. (Máx. 10MB)
                  </div>
                </div>

                <div class="text-end mt-4">
                  <button
                    type="submit"
                    class="btn btn-primary px-4 py-2"
                    id="btn-submit-form"
                  >
                    Publicar Documento
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </main>
    <footer class="bg-white border-top">
      <div
        class="container d-flex flex-column flex-md-row align-items-center justify-content-between gap-2"
      >
        <span>Secretaria de Administração - SAD — Prefeitura do Recife</span>
        <span class="text-muted">© 2025 • Coordenadoria de Processos Seletivos</span>
      </div>
    </footer>

    <div
      class="modal fade"
      id="responseModal"
      tabindex="-1"
      aria-labelledby="responseModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header border-0 pb-0">
            <h5 class="modal-title fw-semibold" id="responseModalLabel"></h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Fechar"
            ></button>
          </div>
          <div class="modal-body pt-0" id="responseModalBody"></div>
          <div class="modal-footer border-0 pt-0">
            <button
              type="button"
              class="btn btn-outline-secondary"
              data-bs-dismiss="modal"
            >
              Fechar
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Elementos do Formulário Principal
        const mainForm = document.getElementById("form-documento");
        const formDescricao = document.getElementById("doc-descricao");
        const formArquivo = document.getElementById("arquivo");
        const submitButton = document.getElementById("btn-submit-form");
        const responseModalElement = document.getElementById("responseModal");
        const responseModal = new bootstrap.Modal(responseModalElement);
        const modalTitle = document.getElementById("responseModalLabel");
        const modalBody = document.getElementById("responseModalBody");

        // Nova lógica: Ouvir o evento 'submit' do formulário
        mainForm.addEventListener("submit", function (event) {
          // 1. Impedir o envio padrão do HTML
          event.preventDefault();

          // 2. Validação simples para ver se os campos estão preenchidos
          if (
            formDescricao.value.trim() === "" ||
            formArquivo.files.length === 0
          ) {
            alert(
              "Por favor, preencha a descrição e selecione um arquivo antes de continuar."
            );
            return; // Interrompe o envio
          }

          // 3. Desabilitar o botão e mostrar "Enviando..."
          submitButton.disabled = true;
          submitButton.textContent = "Enviando...";

          // 4. Pega os dados do formulário (agora com os 'name' corretos)
          const formData = new FormData(mainForm);
          const webhookUrl = mainForm.action; // Pega o URL do 'action' do formulário

          // 5. Envia os dados para o webhook
          fetch(webhookUrl, {
            method: "POST",
            body: formData, // FormData é ideal para enviar arquivos (multipart/form-data)
          })
            .then((response) => {
              if (response.ok) {
                // Se o webhook respondeu com sucesso (status 200-299)
                return response.text(); // ou .json() se seu webhook retornar JSON
              }
              // Se o webhook respondeu com erro
              throw new Error(
                "Falha no envio. O servidor respondeu com status: " +
                  response.status
              );
            })
            .then((data) => {
              // Sucesso total
              modalTitle.textContent = "✅ Sucesso";
              modalTitle.classList.remove("text-danger");
              modalTitle.classList.add("text-success");
              modalBody.innerHTML = `
                <p class="mb-0">Documento publicado com sucesso!</p>
              `.trim();
              responseModal.show();
              mainForm.reset(); // Limpa o formulário
            })
            .catch((error) => {
              // Falha no envio (erro de rede ou erro do servidor)
              console.error("Erro ao enviar para o webhook:", error);
              modalTitle.textContent = "❌ Falha";
              modalTitle.classList.remove("text-success");
              modalTitle.classList.add("text-danger");
              modalBody.innerHTML = `
                <p class="mb-2">Não foi possível publicar o documento.</p>
                <p class="mb-0 text-muted">
                  Verifique sua conexão ou o endpoint do webhook.<br />
                  <span class="fst-italic">${error.message}</span>
                </p>
              `.trim();
              responseModal.show();
            })
            .finally(() => {
              // Independentemente de sucesso ou falha, reabilita o botão
              submitButton.disabled = false;
              submitButton.textContent = "Publicar Documento";
            });
        });
      });
    </script>
    </body>
</html>
